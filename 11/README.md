# Домашнее задание к занятию «Компоненты Kubernetes»

## Задание 1.  Необходимо определить требуемые ресурсы

* Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

1. Необходимо упаковать приложение в чарт для деплоя в разные окружения.
2.  База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.

- 3 копии БД, соответственно необходимо 3 pod 1 CPU и 4 GB RAM для БД.

3.  Кеш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.

- 3 копии для подов кеш, соответственно необходимо 3 pod 1 CPU и 4 GB RAM.

4.  Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.

- 5 копий фронтенд, соответсвенно, нужно 5 pod 0.2 ядро CPU и 50МБ RAM.

5.  Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

- 10 копий бекенд, соответственно, нужно 10 pod 600Мб ОЗУ и 1 CPU для бекенд.

### Рассчитываем количество нод. Поскольку требуется отказоустойчивость, то, согласно рекомендациям, выбираем следующую конфигурацию:

- 3 мастер-ноды (Kubernetes использует механизм кворума для согласования данных на мастер-нодах, а кворум требует нечетного числа участников). 
  Это необходимо для резервирования служебной информации кластера и высокой доступности. Выход их строя одной из мастер-нод не нарушает работу системы.
  Согласно рекомендациям для высокой доступности мы не разворачиваем приложения на мастер-нодах. Также рекомендуется 2 CPU и 2 GB RAM минимум для
  мастер-ноды кубернетес. Тем не менее, не стоит выбирать минимальную конфигурацию, а остановимся на 4CPU и 8RAM для физического сервера.
- 5 Воркер-нод. Почему 5? 10 копий бэкенд, по 2 копии на каждую из нод. 5 копий фронт-энд, по 1 копии на каждую ноду.
  БД по 1 копии на трех нодах, Кеш по 1 копии на 3-х нодах. Выход из строя одной из нод не вызовет замедления или отказа в обслуживании.

### Теперь ресурсы каждой ноды:
- для мастер-ноды рекомендации 2GB RAM и 2 CPU. В данном случае не стоит выбирать минимальные требования, поскольку они могут
  подойти для тестовых стендов. Кроме того, физический сервер с 2GB RAM и 2 CPU это уже "экзотика".
  Выберем 4CPU и 8 GB RAM для серверов с мастер-нодами.

- для вокер-нод:
  Все вокер ноды будут одинаковые для унификации. В данной небольшой конфигурации это будет оправдано.
  На максимально загруженной вокер ноде будет:
  2 копии бекенд 0.6GB RAM и 1CPU, 1 копия фронтенд 0.05 RAM и 0.2 CPU, 1 копия БД 4 GB RAM и 1 CPU и 1 копия кеш 4 GB RAM и 1 CPU
  Соответственно суммарно 8.65 GB RAM и 3.2 CPU для каждой вокер ноды.
  Однако, если одна из нод выйдет из строя (пусть загруженная с БД и с кеш), то поды переместятся на одну из рабочих НОД. Поскольку
  у нас есть ноды без БД и кеш, то соответственно перемещаться будут туда и мы укладываемся в диапазон кроме запаса на бек и фронт 1.02 CPU и 0.65RAM.
  Учтем этот запас: RAM 8.65 + 0.65 = 9.3RAM и CPU 3.2 + 1.2 = 4.4 CPU. Также учтем работу самой ноды: 2RAM и 2 CPU.
  Итого: RAM 9.3+2=11.3. Округляем до 16GB RAM для физического сервера (двухканальный режим, стандарт. 12GB - это все же не стандартный случай).
         CPU 4.4+2= 6.2. Округляем до 8 CPU для физического сервера.

### Заключение:
- 3 мастер ноды: физические серверы 4CPU и 8GB RAM.
- 5 вокер нод  : физические серверы 8CPU и 16GB RAM.

### В случае с виртуальными машинами в облаке, можно произвести более точные расчеты, уменьшить запасы, смотреть по ситуации и увеличивать по необходимости.
  




  
